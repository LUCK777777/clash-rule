mode: rule
mixed-port: 7890
allow-lan: false
ipv6: false
unified-delay: true
tcp-concurrent: true
find-process-mode: strict
global-client-fingerprint: chrome
log-level: warning

profile:
  store-selected: true
  store-fake-ip: true

# ✅ 必须启用 TUN，否则系统 DNS 一定会泄露
tun:
  enable: true
  stack: mixed
  mtu: 1400
  dns-hijack:
    - any:53
    - tcp://any:53
  auto-route: true
  auto-detect-interface: true
  strict-route: true
  inet4-address: 198.18.0.1/16

# ✅ 防泄露 DNS：全程 DoH + 不走系统解析器
dns:
  enable: true
  listen: 0.0.0.0:1053
  ipv6: false
  prefer-h3: false
  respect-rules: true

  enhanced-mode: fake-ip
  fake-ip-range: 198.18.0.1/16

  # 用于解析 DoH 域名自身（避免系统 DNS）
  default-nameserver:
    - 1.1.1.1
    - 8.8.8.8

  # 代理流量解析（走代理链路）
  proxy-server-nameserver:
    - https://1.1.1.1/dns-query
    - https://8.8.8.8/dns-query

  # 直连流量解析（仍用加密 DNS，避免本地运营商）
  direct-nameserver:
    - https://1.1.1.1/dns-query
    - https://8.8.8.8/dns-query

  # 默认解析器（同样加密）
  nameserver:
    - https://1.1.1.1/dns-query
    - https://8.8.8.8/dns-query

  fake-ip-filter:
    - "*.lan"
    - "*.local"
    - "localhost"
    - "*.msftconnecttest.com"
    - "msftconnecttest.com"
    - "*.msftncsi.com"
    - "msftncsi.com"
    - "connectivitycheck.gstatic.com"
    - "captive.apple.com"
    - "detectportal.firefox.com"
    - "*.push.apple.com"
    - "*.apple.com"
    - "*.wechat.com"
    - "*.weixin.qq.com"
    - "*.qq.com"
    - "*.qpic.cn"
