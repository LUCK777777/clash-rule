# @ä¸“ç”¨é…ç½®
# æ›´æ–°æ—¶é—´: 2026.01.01

# --- åŸºç¡€é…ç½® ---
ipv6: true
http_port: 3080
socks_port: 3090
allow_external_connections: true
vif_only: true
hide_vpn_icon: true

# --- DNS åŠ«æŒ ---
hijack_dns:
  - "*:53"

# --- æ•°æ®åº“ URL é…ç½® ---
geoip_db_url: https://raw.githubusercontent.com/Loyalsoldier/geoip/release/Country.mmdb
asn_db_url: https://raw.githubusercontent.com/Loyalsoldier/geoip/release/GeoLite2-ASN.mmdb

# --- å»¶è¿Ÿæµ‹è¯• URL é…ç½® ---
proxy_latency_test_url: https://www.google.com/generate_204
direct_latency_test_url: http://www.apple.com/library/test/success.html

# --- è·¯ç”±é…ç½® ---
compat_route: false
include_all_networks: false
include_apns: false
include_cellular_services: false
include_local_networks: false

# --- DNS é…ç½®ï¼ˆä¿æŒä½ æä¾›çš„ DNS åˆ†æµï¼‰---
dns:
  bootstrap:
    - 223.5.5.5
    - 119.29.29.29
  upstreams:
    å›½å¤–:
      - tls://1.1.1.1
      - https://8.8.8.8/dns-query
      - https://1.1.1.1/dns-query
      - tls://dns.google
    å›½å†…:
      - tls://dns.alidns.com
      - tls://dot.pub
      - https://doh.pub/dns-query
      - https://dns.alidns.com/dns-query
    è…¾è®¯:
      - tls://dot.pub
      - https://doh.pub/dns-query
    é˜¿é‡Œå·´å·´:
      - tls://dns.alidns.com
      - https://dns.alidns.com/dns-query
    å­—èŠ‚è·³åŠ¨:
      - 180.184.2.2
      - 180.184.1.1
  forward:
    - proxy_rule_set:
        match: https://rule.kelee.one/Loon/DouYin.lsr
        value: å­—èŠ‚è·³åŠ¨
        disabled: false
    - proxy_rule_set:
        match: https://rule.kelee.one/Loon/TestFlight.lsr
        value: å›½å¤–
        disabled: false
    - proxy_rule_set:
        match: https://rule.kelee.one/Loon/Apple.lsr
        value: å›½å†…
        disabled: false
    - proxy_rule_set:
        match: https://rule.kelee.one/Loon/Alibaba.lsr
        value: é˜¿é‡Œå·´å·´
        disabled: false
    - proxy_rule_set:
        match: https://rule.kelee.one/Loon/Tencent.lsr
        value: è…¾è®¯
        disabled: false
    - proxy_rule_set:
        match: https://rule.kelee.one/Loon/ChinaMax.lsr
        value: å›½å†…
        disabled: false
    - proxy_rule_set:
        match: https://rule.kelee.one/Loon/Global.lsr
        value: å›½å¤–
        disabled: false
    - wildcard:
        match: "*"
        value: å›½å¤–
        disabled: false
  public_ip_lookup_url: https://ifconfig.me/ip

# --- ç­–ç•¥ç»„é…ç½® ---
policy_groups:
  # å¤–éƒ¨è®¢é˜…æºï¼ˆæŠŠä½ çš„è®¢é˜…åŠ å…¥è¿™é‡Œï¼‰
  - external:
      name: å…¨éƒ¨èŠ‚ç‚¹
      type: select
      urls:
        - https://ch.liy343012.workers.dev/key?sub
        - https://sub.store/download/collection/AllServer?target=Egern
      icon: https://raw.githubusercontent.com/LUCK777777/photo/main/icons8-yu-96.png

  # è‡ªå»ºèŠ‚ç‚¹ï¼ˆæŒ‰å…³é”®è¯åŒ¹é…ï¼šè‡ªå»º|DIY|VPS|MyNode|Self|NATï¼‰
  - select:
      name: è‡ªå»ºèŠ‚ç‚¹
      policies:
        - å…¨éƒ¨èŠ‚ç‚¹
      flatten: true
      filter: "(?i)(è‡ªå»º|DIY|VPS|MyNode|Self|NAT)"
      icon: https://raw.githubusercontent.com/LUCK777777/photo/main/icons8-cloudflare-96.png

  # è‡ªåŠ¨æµ‹é€Ÿåˆ†ç»„ï¼ˆä¿®æ­£ filterï¼šå»æ‰å¼€å¤´ |ï¼Œé¿å…å…¨åŒ¹é…ï¼‰
  - auto_test:
      name: é¦™æ¸¯èŠ‚ç‚¹
      policies:
        - å…¨éƒ¨èŠ‚ç‚¹
      flatten: true
      filter: "(?i)(ğŸ‡­ğŸ‡°|é¦™æ¸¯|\\bHK\\b|\\bHKG\\b|Hong\\s*Kong|HongKong)"
      icon: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/image/HongKong.png

  - auto_test:
      name: ç¾å›½èŠ‚ç‚¹
      policies:
        - å…¨éƒ¨èŠ‚ç‚¹
      flatten: true
      filter: "(?i)(ğŸ‡ºğŸ‡¸|ç¾å›½|ç¾åœ‹|\\bUS\\b|\\bUSA\\b|United\\s*States)"
      icon: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/image/UnitedStates.png

  - auto_test:
      name: å°æ¹¾èŠ‚ç‚¹
      policies:
        - å…¨éƒ¨èŠ‚ç‚¹
      flatten: true
      filter: "(?i)(ğŸ‡¹ğŸ‡¼|å°æ¹¾|å°ç£|\\bTW\\b|Taiwan)"
      icon: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/image/Taiwan.png

  - auto_test:
      name: æ—¥æœ¬èŠ‚ç‚¹
      policies:
        - å…¨éƒ¨èŠ‚ç‚¹
      flatten: true
      filter: "(?i)(ğŸ‡¯ğŸ‡µ|æ—¥æœ¬|\\bJP\\b|\\bJPN\\b|Japan)"
      icon: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/image/Japan.png

  - auto_test:
      name: ç‹®åŸèŠ‚ç‚¹
      policies:
        - å…¨éƒ¨èŠ‚ç‚¹
      flatten: true
      filter: "(?i)(ğŸ‡¸ğŸ‡¬|æ–°åŠ å¡|ç‹®åŸ|ç…åŸ|\\bSG\\b|Singapore)"
      icon: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/image/Singapore.png

  # âœ… å·²åˆ é™¤ï¼šéŸ©å›½èŠ‚ç‚¹ï¼ˆè®©éŸ©å›½æ‰å…¥å…¶ä»–èŠ‚ç‚¹ï¼‰

  # å‰©ä½™èŠ‚ç‚¹ï¼ˆå·²ç§»é™¤â€œéŸ©å›½/KR/KOR/Koreaâ€çš„æ’é™¤æ¡ä»¶ï¼Œè®©éŸ©å›½èŠ‚ç‚¹è½å…¥æ­¤ç»„ï¼‰
  - select:
      name: å…¶ä»–èŠ‚ç‚¹
      policies:
        - å…¨éƒ¨èŠ‚ç‚¹
      flatten: true
      filter: "^((?!(è‡ªå»º|DIY|VPS|MyNode|Self|NAT|ğŸ‡­ğŸ‡°|é¦™æ¸¯|\\bHK\\b|\\bHKG\\b|Hong\\s*Kong|HongKong|ğŸ‡ºğŸ‡¸|ç¾å›½|ç¾åœ‹|\\bUS\\b|\\bUSA\\b|United\\s*States|ğŸ‡¹ğŸ‡¼|å°æ¹¾|å°ç£|\\bTW\\b|Taiwan|ğŸ‡¯ğŸ‡µ|æ—¥æœ¬|\\bJP\\b|\\bJPN\\b|Japan|ğŸ‡¸ğŸ‡¬|æ–°åŠ å¡|ç‹®åŸ|ç…åŸ|\\bSG\\b|Singapore)).)*$"
      icon: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/image/WorldMap.png

  # ä¸»æ‰‹åŠ¨åˆ‡æ¢ç­–ç•¥ï¼ˆç§»é™¤ éŸ©å›½èŠ‚ç‚¹ï¼‰
  - select:
      name: è‡ªé€‰ç­–ç•¥
      policies:
        - è‡ªå»ºèŠ‚ç‚¹
        - é¦™æ¸¯èŠ‚ç‚¹
        - ç¾å›½èŠ‚ç‚¹
        - ç‹®åŸèŠ‚ç‚¹
        - å°æ¹¾èŠ‚ç‚¹
        - æ—¥æœ¬èŠ‚ç‚¹
        - å…¶ä»–èŠ‚ç‚¹
        - DIRECT
      icon: https://raw.githubusercontent.com/LUCK777777/photo/main/icons8-zy-100.png

  # åº”ç”¨ç­–ç•¥ç»„ï¼ˆæŒ‰ä½ è¦æ±‚åˆ æ‰ HBO / YouTubeMusicï¼‰
  - select:
      name: AIGC
      policies:
        - è‡ªé€‰ç­–ç•¥
      flatten: true
      icon: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/image/ChatGPT.png

  - select:
      name: Apple
      policies:
        - è‡ªé€‰ç­–ç•¥
      flatten: true
      icon: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/image/Apple.png

  - select:
      name: Disney
      policies:
        - è‡ªé€‰ç­–ç•¥
      flatten: true
      icon: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/image/Disney.png

  - select:
      name: GitHub
      policies:
        - è‡ªé€‰ç­–ç•¥
      flatten: true
      icon: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/image/GitHub.png

  - select:
      name: Google
      policies:
        - è‡ªé€‰ç­–ç•¥
      flatten: true
      icon: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/image/Google.png

  - select:
      name: Microsoft
      policies:
        - è‡ªé€‰ç­–ç•¥
      flatten: true
      icon: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/image/Microsoft.png

  - select:
      name: Netflix
      policies:
        - è‡ªé€‰ç­–ç•¥
      flatten: true
      icon: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/image/Netflix.png

  - select:
      name: PayPal
      policies:
        - è‡ªé€‰ç­–ç•¥
      flatten: true
      icon: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/image/PayPal.png

  - select:
      name: Spotify
      policies:
        - è‡ªé€‰ç­–ç•¥
      flatten: true
      icon: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/image/Spotify.png

  - select:
      name: Telegram
      policies:
        - è‡ªé€‰ç­–ç•¥
      flatten: true
      icon: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/image/Telegram.png

  - select:
      name: TikTok
      policies:
        - è‡ªé€‰ç­–ç•¥
      flatten: true
      icon: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/image/TikTok.png

  - select:
      name: Twitter
      policies:
        - è‡ªé€‰ç­–ç•¥
      flatten: true
      icon: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/image/Twitter.png

  - select:
      name: WeChat
      policies:
        - è‡ªé€‰ç­–ç•¥
      flatten: true
      icon: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/image/WeChat.png

  - select:
      name: YouTube
      policies:
        - è‡ªé€‰ç­–ç•¥
      flatten: true
      icon: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/image/YouTube.png

  # ä½ æ–°å¢çš„ä¸¤ä¸ªç­–ç•¥ç»„ï¼ˆå›¾æ ‡æ”¹æˆç›´é“¾ rawï¼‰
  - select:
      name: äº¤æ˜“æ‰€
      policies:
        - è‡ªé€‰ç­–ç•¥
        - DIRECT
      flatten: true
      icon: https://raw.githubusercontent.com/LUCK777777/photo/main/icons8-btc-94.png

  # âœ… TRDRï¼šä¸å†èµ°å›½å®¶åˆ†ç»„ï¼Œç›´æ¥åˆ—å‡ºâ€œå…¨éƒ¨èŠ‚ç‚¹â€é‡Œçš„æ‰€æœ‰èŠ‚ç‚¹
  - select:
      name: TRDR
      policies:
        - å…¨éƒ¨èŠ‚ç‚¹
        - DIRECT
      flatten: true
      icon: https://raw.githubusercontent.com/LUCK777777/photo/main/icons8-usdt144.png

# --- ä»£ç†è§„åˆ™é…ç½® ---
# è§„åˆ™åŒ¹é…é¡ºåºéå¸¸é‡è¦ï¼šå»å¹¿å‘Š -> å±€åŸŸç½‘/å›½å†…ç›´è¿ -> ç‰¹å®šAPPä»£ç† -> å…œåº•ä»£ç†
rules:
  # 1) å¼ºåˆ¶æ‹’ç»/æ‹¦æˆª
  - rule_set:
      match: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/Egern/Rule/Reject.yaml
      policy: REJECT
  - domain_regex:
      match: "^ad\\..*|^ads\\..*|^advert\\..*"
      policy: REJECT

  # 2) æœ¬åœ°ç½‘ç»œç›´è¿
  - rule_set:
      match: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/Egern/Rule/Lan.yaml
      policy: DIRECT

  # 3) å›½å†…æµé‡ç›´è¿
  - rule_set:
      match: https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/ChinaMax/ChinaMax_All.list
      policy: DIRECT
      interval: 86400
  - domain_suffix:
      match: "*.cn"
      policy: DIRECT
  - geoip:
      match: CN
      policy: DIRECT
      no_resolve: true

  # 4) ä½ æ–°å¢çš„è¿œç¨‹è§„åˆ™é›†ï¼šäº¤æ˜“æ‰€ / TRDR
  - rule_set:
      match: https://raw.githubusercontent.com/LUCK777777/clash-rule/refs/heads/main/rule/rule/binance.yaml
      policy: äº¤æ˜“æ‰€
      interval: 86400
  - rule_set:
      match: https://raw.githubusercontent.com/LUCK777777/clash-rule/refs/heads/main/rule/rule/trdr.yaml
      policy: TRDR
      interval: 86400

  # 5) ä¸“æœ‰æœåŠ¡/åº”ç”¨ä»£ç†ï¼ˆå·²ç§»é™¤ HBO / YouTubeMusicï¼‰
  - rule_set:
      match: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/Egern/Rule/Apple.yaml
      policy: Apple
  - rule_set:
      match: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/Egern/Rule/AppleProxy.yaml
      policy: é¦™æ¸¯èŠ‚ç‚¹
  - rule_set:
      match: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/Egern/Rule/AIGC.yaml
      policy: AIGC
  - rule_set:
      match: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/Egern/Rule/Bing.yaml
      policy: ç¾å›½èŠ‚ç‚¹
  - rule_set:
      match: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/Egern/Rule/Disney.yaml
      policy: Disney
  - rule_set:
      match: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/Egern/Rule/Github.yaml
      policy: GitHub
  - rule_set:
      match: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/Egern/Rule/Google.yaml
      policy: Google
  - rule_set:
      match: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/Egern/Rule/Microsoft.yaml
      policy: Microsoft
  - rule_set:
      match: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/Egern/Rule/Netflix.yaml
      policy: Netflix
  - rule_set:
      match: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/Egern/Rule/PayPal.yaml
      policy: PayPal
  - rule_set:
      match: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/Egern/Rule/Spotify.yaml
      policy: Spotify
  - rule_set:
      match: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/Egern/Rule/Telegram.yaml
      policy: Telegram
  - rule_set:
      match: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/Egern/Rule/TikTok.yaml
      policy: TikTok
  - rule_set:
      match: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/Egern/Rule/Twitter.yaml
      policy: Twitter
  - rule_set:
      match: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/Egern/Rule/WeChat.yaml
      policy: WeChat
  - rule_set:
      match: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/Egern/Rule/YouTube.yaml
      policy: YouTube

  # 6) å‰©ä½™ä»£ç†
  - rule_set:
      match: https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/Proxy/Proxy_All.list
      policy: è‡ªé€‰ç­–ç•¥

  # 7) æœ€ç»ˆé»˜è®¤ç­–ç•¥
  - default:
      policy: è‡ªé€‰ç­–ç•¥

# --- MITM é…ç½® ---
mitm:
  enabled: true
  ca_p12: Legern.p12
  ca_passphrase: "241936"
  hostnames:
    - "*.google.com"
    - "*.github.com"

# --- æ¨¡å—é…ç½® ---
modules:
  - url: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/Egern/Module/Panel.yaml
    enabled: true
    interval: 3600

  - name: Sub-Store
    url: https://raw.githubusercontent.com/sub-store-org/Sub-Store/master/config/Egern.yaml
    enabled: true

  - name: WeatherKit
    url: https://github.com/NSRingo/WeatherKit/releases/latest/download/iRingo.WeatherKit.sgmodule
    enabled: true

  - name: "YouTube Enhance"
    url: https://raw.githubusercontent.com/Maasea/sgmodule/master/YouTube.Enhance.sgmodule
    enabled: true
