ipv6: true
http_port: 3080
socks_port: 3090
allow_external_connections: true
vif_only: true
hide_vpn_icon: true

# DNS server addresses to hijack.
hijack_dns:
  - "*:53"

# GeoIP database URL
geoip_db_url: https://raw.githubusercontent.com/Loyalsoldier/geoip/release/Country.mmdb

# ASN database URL
asn_db_url: https://raw.githubusercontent.com/Loyalsoldier/geoip/release/GeoLite2-ASN.mmdb

# Direct connection latency test URL
direct_latency_test_url: https://captive.apple.com

# Proxy latency test URL
proxy_latency_test_url: https://www.google.com/generate_204

dns:
  bootstrap:
    - 223.5.5.5
    - 119.29.29.29
    - 2400:3200::1
  upstreams:
    Global:
      - quic://dns.adguard-dns.com
      - tls://1.1.1.1
      - https://8.8.8.8/dns-query
      - https://1.1.1.1/dns-query
    China:
      - tls://dns.alidns.com
      - tls://dot.pub
      - https://doh.pub/dns-query
      - https://dns.alidns.com/dns-query
    Tencent:
      - tls://dot.pub
      - https://doh.pub/dns-query
    Alibaba:
      - tls://dns.alidns.com
      - https://dns.alidns.com/dns-query
    Bytedance:
      - 180.184.2.2
      - 180.184.1.1
    AdGuard:
      - quic://dns.adguard-dns.com
      - tls://dns.adguard-dns.com
      - https://dns.adguard-dns.com/dns-query

  forward:
    - regex:
        match: ^ad(s?)\.
        value: AdGuard
    - proxy_rule_set:
        match: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/Egern/Rule/Douyin.lsr
        value: Bytedance
    - proxy_rule_set:
        match: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/Egern/Rule/Apple.lsr
        value: China
    - proxy_rule_set:
        match: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/Egern/Rule/Alibaba.lsr
        value: Alibaba
    - proxy_rule_set:
        match: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/Egern/Rule/Tencent.lsr
        value: Tencent
    # 注意：使用 rule_set 分流 DNS 会增加内存开销，如遇卡顿可尝试注释下方 block
    - proxy_rule_set:
        match: https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/ChinaMax/ChinaMax_All.list
        value: China
    - wildcard:
        match: "*"
        value: Global

  public_ip_lookup_url: https://ifconfig.me/ip

policy_groups:
  - external:
      name: 全部节点
      type: select
      urls:
        - https://sub.store/download/collection/AllServer?target=Egern
      icon: ""
      hidden: false

  - select:
      name: Proxy
      policies:
        - 香港节点
        - 台湾节点
        - 日本节点
        - 新加坡节点
        - 美国节点
        - 全部节点
        - DIRECT

  - select:
      name: Global
      icon: https://raw.githubusercontent.com/Orz-3/mini/master/Color/Global.png
      policies:
        - Proxy
        - 香港节点
        - 台湾节点
        - 日本节点
        - 新加坡节点
        - 美国节点
        - DIRECT

  - select:
      name: OpenAI
      icon: https://raw.githubusercontent.com/Orz-3/mini/master/Color/OpenAI.png
      policies:
        - Proxy
        - 香港节点
        - 台湾节点
        - 日本节点
        - 新加坡节点
        - 美国节点
        - DIRECT

  - select:
      name: TikTok
      icon: https://raw.githubusercontent.com/Orz-3/mini/master/Color/TikTok.png
      policies:
        - Proxy
        - 香港节点
        - 台湾节点
        - 日本节点
        - 新加坡节点
        - 美国节点
        - DIRECT

  - select:
      name: Telegram
      icon: https://raw.githubusercontent.com/Orz-3/mini/master/Color/Telegram.png
      policies:
        - Proxy
        - 香港节点
        - 台湾节点
        - 日本节点
        - 新加坡节点
        - 美国节点
        - DIRECT

  - select:
      name: YouTube
      icon: https://raw.githubusercontent.com/Orz-3/mini/master/Color/YouTube.png
      policies:
        - Proxy
        - 香港节点
        - 台湾节点
        - 日本节点
        - 新加坡节点
        - 美国节点
        - DIRECT

  - select:
      name: Netflix
      icon: https://raw.githubusercontent.com/Orz-3/mini/master/Color/Netflix.png
      policies:
        - Proxy
        - 香港节点
        - 台湾节点
        - 日本节点
        - 新加坡节点
        - 美国节点
        - DIRECT

  - select:
      name: Disney
      icon: https://raw.githubusercontent.com/Orz-3/mini/master/Color/Disney.png
      policies:
        - Proxy
        - 香港节点
        - 台湾节点
        - 日本节点
        - 新加坡节点
        - 美国节点
        - DIRECT

  - select:
      name: HBO
      icon: https://raw.githubusercontent.com/Orz-3/mini/master/Color/HBO.png
      policies:
        - Proxy
        - 香港节点
        - 台湾节点
        - 日本节点
        - 新加坡节点
        - 美国节点
        - DIRECT

  - select:
      name: AppleProxy
      icon: https://raw.githubusercontent.com/Orz-3/mini/master/Color/Apple.png
      policies:
        - Proxy
        - 香港节点
        - 台湾节点
        - 日本节点
        - 新加坡节点
        - 美国节点
        - DIRECT

  - select:
      name: GitHub
      icon: https://raw.githubusercontent.com/Orz-3/mini/master/Color/GitHub.png
      policies:
        - Proxy
        - 香港节点
        - 台湾节点
        - 日本节点
        - 新加坡节点
        - 美国节点
        - DIRECT

  - select:
      name: Speedtest
      icon: https://raw.githubusercontent.com/Orz-3/mini/master/Color/Speedtest.png
      policies:
        - Proxy
        - 香港节点
        - 台湾节点
        - 日本节点
        - 新加坡节点
        - 美国节点
        - DIRECT

  - auto_test:
      name: 香港节点
      policies:
        - 全部节点
      flatten: true
      filter: |香港|HK|Hong
      icon: https://raw.githubusercontent.com/Orz-3/mini/master/Color/Hong_Kong.png

  - auto_test:
      name: 台湾节点
      policies:
        - 全部节点
      flatten: true
      filter: |台湾|TW|Tai
      icon: https://raw.githubusercontent.com/Orz-3/mini/master/Color/Taiwan.png

  - auto_test:
      name: 日本节点
      policies:
        - 全部节点
      flatten: true
      filter: |日本|JP|Japan
      icon: https://raw.githubusercontent.com/Orz-3/mini/master/Color/Japan.png

  - auto_test:
      name: 新加坡节点
      policies:
        - 全部节点
      flatten: true
      filter: |新加坡|SG|Sing
      icon: https://raw.githubusercontent.com/Orz-3/mini/master/Color/Singapore.png

  - auto_test:
      name: 美国节点
      policies:
        - 全部节点
      flatten: true
      filter: |美国|US|United
      icon: https://raw.githubusercontent.com/Orz-3/mini/master/Color/United_States.png

rules:
  # 1. 广告拦截
  - rule_set:
      match: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/Egern/Rule/Reject.yaml
      policy: REJECT
  - domain_regex:
      match: ^ad\..*|^ads\..*|^advert\..*
      policy: REJECT

  # 2. 局域网直连
  - rule_set:
      match: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/Egern/Rule/Lan.yaml
      policy: DIRECT

  # 3. 国内流量直连
  - rule_set:
      match: https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/ChinaMax/ChinaMax_All.list
      policy: DIRECT
      update_interval: 86400
  - domain_suffix:
      match: 'cn'
      policy: DIRECT
  - geoip:
      match: CN
      policy: DIRECT

  # 4. 分流
  - rule_set:
      match: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/Egern/Rule/OpenAI.yaml
      policy: OpenAI
  - rule_set:
      match: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/Egern/Rule/TikTok.yaml
      policy: TikTok
  - rule_set:
      match: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/Egern/Rule/Telegram.yaml
      policy: Telegram
  - rule_set:
      match: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/Egern/Rule/YouTube.yaml
      policy: YouTube
  - rule_set:
      match: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/Egern/Rule/Netflix.yaml
      policy: Netflix
  - rule_set:
      match: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/Egern/Rule/Disney.yaml
      policy: Disney
  - rule_set:
      match: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/Egern/Rule/HBO.yaml
      policy: HBO
  - rule_set:
      match: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/Egern/Rule/AppleProxy.yaml
      policy: AppleProxy
  - rule_set:
      match: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/Egern/Rule/Github.yaml
      policy: GitHub
  - rule_set:
      match: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/Egern/Rule/Speedtest.yaml
      policy: Speedtest

  # 5. 兜底
  - default:
      policy: Global

mitm:
  enabled: true
  ca_p12: Legern.p12
  ca_passphrase: 241936
  hostnames:
    - example.com

  hostnames:
    - '*.google.com'
    - '*.youtube.com'

modules:
  - name: Panel
    url: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/Egern/Module/Panel.yaml
    enabled: true
    update_interval: 3600
  - name: Sub-Store
    url: https://raw.githubusercontent.com/sub-store-org/Sub-Store/master/config/Egern.yaml
    enabled: true
  - name: WeatherKit
    url: https://github.com/NSRingo/WeatherKit/releases/latest/download/iRingo.WeatherKit.sgmodule
    enabled: true
  - name: 'YouTube Enhance'
    url: https://raw.githubusercontent.com/Maasea/sgmodule/master/YouTube.Enhance.sgmodule
    enabled: true
    update_interval: 86400
  - name: 奶思广告拦截&净化合集
    url: https://raw.githubusercontent.com/fmz200/wool_scripts/main/Surge/module/blockAds.module
    enabled: false
    update_interval: 86400
